- name: Generate Audio
        env:
          API_KEY: ${{ secrets.API_KEY }}
        run: |
          rm -rf audios # Remove se for arquivo, limpa se for pasta
          mkdir -p audios # Cria a pasta limpa
          cat << 'EOF' > generator.mjs
          import { GoogleGenAI } from '@google/genai';
          import fs from 'fs';

          async function start() {
            const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
            const date = new Date().toISOString().split('T')[0];
            
            const gistUrl = 'https://gist.githubusercontent.com/mickrds/b34732e31123be1e934e6bb0ffd0a0ef/raw/devocionais.json';
            const response = await fetch(gistUrl);
            const devocionais = await response.json();
            const hoje = devocionais[date];

            if (!hoje) return;

            const texto = `${hoje.title}. ${hoje.verseText}. ${hoje.content}`.replace(/\n/g, ' ');
            
            const result = await ai.models.generateContent({
              model: 'gemini-2.5-flash-preview-tts',
              contents: [{ parts: [{ text: texto }] }],
              config: { 
                responseModalities: ['AUDIO'],
                speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: 'Kore' } } }
              }
            });

            const audioPart = result.candidates[0].content.parts.find(p => p.inlineData);
            if (audioPart) {
              fs.writeFileSync(`audios/${date}.mp3`, Buffer.from(audioPart.inlineData.data, 'base64'));
              console.log('√Åudio salvo.');
            }
          }
          start();
          EOF
          node generator.mjs
